name: Code Coverage

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest
    
    services:
      mariadb:
        image: mariadb:10.1
        env:
          MYSQL_DATABASE: 'partkeepr_test'
          MYSQL_ALLOW_EMPTY_PASSWORD: 'yes'
          MYSQL_USER: partkeepr
          MYSQL_PASSWORD: partkeepr
          MYSQL_ROOT_PASSWORD: root

    steps:
    - uses: actions/checkout@v2
    - name: Wait for database to be ready
      uses: christianlupus/partkeepr-wait-for-db-action@v1.1
      
    - name: Perform the tests
      uses:  christianlupus/partkeepr-test@master
      
    - name: Pack the code coverage into a artifact
      uses: actions/upload-artifact@v1.0.0
      with:
        name: code-coverage
        path: build/logs/code-coverage
      if: always()
    
